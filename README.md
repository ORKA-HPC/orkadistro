# Docker image for ORKA-HPC

Git URL: git@i2git.cs.fau.de:orka/dockerfiles/orkadistro.git

## Requirements

- Docker v19.0 or higher
- You need to get a Research license from EDG
  1. Contact `info@edg.com`
  2. Write that you need access to the EDG C++ frontend
     sources. To make things as smooth as possible for you, 
     you can mention me, `florian.andrefranc.mayer@fau.de` and
     refer to ORKA-HPC using the ROSE toolchain.
  3. Mail the license to me.

## Getting Started

- `./setup.sh --init` does a clean build of the docker container.
  It also builds ROSE and orkaevolution 
  (both _inside_ the docker container).
  See section `Frequent Issues` if this script fails.
- `./setup.sh --after-pull` will do something similar to `--init`
  but tries to speed things up if possible. Due to the way
  docker works, this will sometimes fail. Try to run the
  script with the environment Variable `CLEAN_BUILD=1` set:
  `CLEAN_BUILD=1 ./setup.sh --after-pull`.
- `./run_docker.sh -r -e -q` starts the docker container and 
  presents a shell to you running in the container. After
  you close that shell (using C-d) it suspends the container.
- `./run_docker.sh --stop-and-remove` stops and removes the
  running container. All your data in the container is
  erased that way.

## Special features of this Distribution

`rebuild_docker.sh` builds a docker image with the
following name: `orkadistro-img-<git-ref>`, where git-ref
is the git commit hash of this repository. This ensures
that you can test and run different Docker images.

`run_docker.sh` starts a docker container with the
following name: `orkadistro-cont-<sha256-hash>`, where
sha256-hash is generated by hashing the content of 
`$PWD`. This ensures that doing

```bash
git clone <orkadistro-uri> orkadistro && cd orkadistro
./setup.sh && ./run_docker -r -e -q
```

gives you access to two _different_ instances of the
same images!

## Frequent Issues

- docker permission issues:
    - `sudo groupadd docker`
    - `sudo usermod -aG docker ${USER}`
    - `sudo service docker restart`
    - Log out and back in.

- You need to run `run_docker.sh --stop-and-unmount` before
  you can `./rebuild.sh` the image again.

## Notes and References

The arty board description files were retrieved from
[github](https://github.com/Digilent/vivado-boards)

Currently, all users of this Distribution need a
EDG research license due to the fact that our
changes of the ROSE library are not merged into
upstream yet.
